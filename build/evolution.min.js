!function(a,b){b.evolution=a;var c=a.$$||function(a){return c[a]||(c[a]={}),c[a]},d=c("c"),e=c("i"),f=c("p");a.$$=c;var g=function(a){return Array.prototype.slice.call(a)},h=function(a){var b=g(arguments),c=b[1];"function"==typeof c?this.c[a]=c():(d[a]=b[2],d[a].$inject=c,d[a].$internal=this.i)},i=function(){h.apply({i:!1,c:a},g(arguments))},j=function(){h.apply({i:!0,c:e},g(arguments))},k=function(b,c){f[b]=!0;var g,h=c.$inject,i=[];for(var j in h)if(h.hasOwnProperty(j)&&(g=h[j],d[g])){if(f.hasOwnProperty(g))throw new Error('Cyclical reference: "'+b+'" referencing "'+g+'"');k(g,d[g]),delete d[g]}if(!a[b]&&!e[b]){for(var l in h)g=h[l],i.push(a.hasOwnProperty(g)&&a[g]||e.hasOwnProperty(g)&&e[g]);c.$internal?e[b]=c.apply(null,i)||b:a[b]=c.apply(null,i)||b}Object.defineProperty(a,"$$",{enumerable:!1,writable:!1}),delete f[b]};j("leaders",function(){function a(){function a(a){var d=!1,e="";if(a.score){for(var f=0;f<b.length;f+=1){for(;a===b[f];)b.splice(f,1);if(b[f]&&"alive"===b[f].status&&a.score>b[f].score){b.splice(f,0,a),f+=1,d=!0;break}}if(!d&&b.length<10&&-1===b.indexOf(a)&&(b.push(a),d=!0),d&&b.length>10&&(b.length=10),d&&c){for(f=0;f<b.length;f+=1)b[f].alive||b.splice(f,1),b[f]&&(e+='<li><span class="leader-name">'+b[f].name+'</span> <span class="leader-score">'+Math.floor(b[f].score)+"</span></li>\n");c.innerHTML=e}}}var b=[],c=document.querySelector(".leaders");this.add=a,this.scores=b}return new a}),j("main",["cell","pellet","mouseControl","AIControl","collision","colors","leaders","getUID"],function(b,c,d,e,f,g,h,i){function j(){return Math.random()*t}function k(){return Math.random()*u}function l(a){for(x=0;a>x;x+=1){var c=b.create(A,Math.random()*t,Math.random()*u,10,2,r);c.type="ai",c.name="Cp",c.id=i(),D.push(c),C.push(c),e(c,t,u)}}function m(a){for(x=0;a>x;x+=1){var b=c.create(A,j(),k(),3*Math.random()+3,"#F0F");b.type="pellet",D.push(b)}}function n(){A.clearRect(0,0,v,w);var a,b,c,d=y.x,e=y.y,g=.5*v,i=.5*w;g>d?d=g:d>t-g&&(d=t-g),i>e?e=i:e>u-i&&(e=u-i);var j={x:d-g,y:e-i},k={x:d+g,y:e+i};for(y.setTargetPoint({x:j.x+z.x,y:j.y+z.y}),a=0;a<D.length;a+=1)b=D[a],b.update();for(a=0;a<D.length;a+=1)b=D[a],b.speed&&(h.add(b),b.speed=t/(.1*b.radius)/100,c=f(b,D),c&&c.radius<b.radius&&(b.eat(c),"ai"===c.type?o(c):c===y?console.log("game over"):"pellet"===c.type&&m(1),D.splice(D.indexOf(c),1))),b.draw(j,k)}function o(a){var b=C.indexOf(a);-1!==b&&(C.splice(b,1),0===C.length&&(console.log("level up",B),B+=1,l(B),y.radius=E))}function p(a){for(var b,c=0;c<D.length;c+=1)if(b=D[c].id,b&&a===b.toString())return D[c]}function q(){function a(a){if(!a.alive)return!1;var b=e[a.id];return!(b&&b.tx===a.lastPoint.x&&b.ty===a.lastPoint.y&&b.radius===a.radius)}function c(){if(-1!==D.indexOf(y)){var b,e={shapes:[]};a(y)&&e.shapes.push({id:y.id.toString(),x:y.x,y:y.y,tx:y.lastPoint.x,ty:y.lastPoint.y,radius:y.radius,color:y.color,alive:y.alive,score:y.score,lastUpdate:Date.now()});for(var f=0;f<C.length;f+=1)b=C[f],a(b)&&e.shapes.push({id:b.id.toString(),x:b.x,y:b.y,tx:b.lastPoint.x,ty:b.lastPoint.y,radius:b.radius,color:b.color,alive:b.alive,lastUpdate:Date.now()});d.send(e),setTimeout(c,100)}}var d=new P2P("g5ezqak33ze3766r","evolution",y),e={};d.onMessage(function(a){for(var c=0;c<a.shapes.length;c+=1){var d,e=a.shapes[c];if(!e.alive)return;d=p(e.id),d&&e.lastUpdate<Date.now()-1e3&&(D.splice(D.indexOf(d),1),d.alive=!1),d||(d=b.create(A,e.x,e.y,E,2,e.color),d.id=e.id,D.push(d)),d.x=e.x,d.y=e.y,d.lastPoint=d.lastPoint||{},d.lastPoint.x=e.tx,d.lastPoint.y=e.ty,d.radius=e.radius}}),d.connect(c)}window.hb=a;var r=g.color,s=document.querySelector(".evolution"),t=2e3,u=2e3,v=1024,w=768;s.width=v,s.height=w;var x,y,z,A=s.getContext("2d"),B=1,C=[],D=[],E=7.5;y=b.create(A,250,250,E,2,r),y.id=i(),y.name=prompt("Please enter your name"),D.push(y),z=d(s),setInterval(n,40),m(200),l(B),q()}),i("getAngle",function(){return function(a,b,c,d){return Math.atan2(d-b,c-a)}}),i("getPointOnCircle",function(){return function(a,b,c,d){return{x:a+c*Math.cos(d),y:b+c*Math.sin(d)}}}),j("pellet",function(){function a(a,b,c,d,e){this.context=a,this.x=b,this.y=c,this.radius=d,this.color=e,this._area=Math.PI*d*d}return a.prototype={update:function(){},area:function(){return this._area},draw:function(a,b){var c,d;this.x>a.x&&this.x<b.x&&this.y>a.y&&this.y<b.y&&(c=this.x-a.x,d=this.y-a.y,this.context.beginPath(),this.context.arc(c,d,this.radius,0,2*Math.PI,!1),this.context.fillStyle=this.color,this.context.fill(),this.context.lineWidth=1,this.context.strokeStyle="#003300",this.context.stroke())}},{create:function(b,c,d,e,f){return new a(b,c,d,e,f)}}}),j("mouseControl",[],function(){function a(a){function b(a){c.x=a.offsetX,c.y=a.offsetY}var c=this;c.x=0,c.y=0,a.addEventListener("mousemove",b)}return function(b){return new a(b)}}),j("AIControl",["getDistance"],function(a){function b(b,c,d){function e(){g.x=Math.random()*c,g.y=Math.random()*d}function f(c){var d=a(b.x,b.y,g.x,g.y);d<b.speed&&e(),b.setTargetPoint(g)}var g=this;g.x=0,g.y=0,e(),setInterval(f,20)}return function(a,c,d){return new b(a,c,d)}}),i("getDistance",function(){return function(a,b,c,d){return Math.sqrt((c-=a)*c+(d-=b)*d)}}),j("collision",["getDistance"],function(a){function b(b,c){for(var d,e,f=0;f<c.length;f+=1)if(d=c[f],e=a(b.x,b.y,d.x,d.y),b!==d&&e<b.radius+d.radius)return d}return b}),j("colors",function(){function a(){return b[Math.floor(Math.random()*b.length)]}var b=["#3F51B5","#4CAF50","#FF9800","#f93b39","#de9c1b","#008bf5","#708bca","#87a5ae","#ff6092"];return{color:a(),randomColor:a}}),j("cell",["getAngle","getPointOnCircle"],function(a,b){function c(a,b,c,d,e,f){this.context=a,this.x=b,this.y=c,this.radius=d,this.speed=e||0,this.color=f||"green",this.lastPoint={x:b,y:c},this.alive=!0,this.score=0}return c.prototype={setTargetPoint:function(a){this.lastPoint=a},area:function(){return Math.PI*this.radius*this.radius},eat:function(a){var b=a.area(),c=this.area()+a.area(),d=c/Math.PI;this.radius=Math.sqrt(d),a.alive=!1,this.score+=b},update:function(){var c=this.lastPoint;if(this.speed){var d=a(this.x,this.y,c.x,c.y),e=b(this.x,this.y,this.speed,d);this.x=e.x,this.y=e.y}},draw:function(a,b){var c,d;this.x>a.x&&this.x<b.x&&this.y>a.y&&this.y<b.y&&(c=this.x-a.x,d=this.y-a.y,this.context.beginPath(),this.context.arc(c,d,this.radius,0,2*Math.PI,!1),this.context.fillStyle=this.color,this.context.fill(),this.context.lineWidth=1,this.context.strokeStyle="#003300",this.context.stroke())}},{create:function(a,b,d,e,f,g){return new c(a,b,d,e,f,g)}}}),j("hb.attr.class",["hb.directive"],function(a){a("class",function(){return{link:["scope","el","$app",function(a,b,c){function d(){this.expr="class";var d,f,h,i=g.length;for(d=0;i>d;d+=1)h=g[d],f=c.parseBinds(a,h.bind),f!==h.last&&h.last&&b.classList.remove(h.last),f&&b.classList.add(f),h.bindOnce&&(g.splice(d,1),d-=1,g.length||a.$unwatch(e)),h.last=f}for(var e,f=b.classList.length,g=[],h=0;f>h;h+=1)-1!==b.classList[h].indexOf(c.bindingMarkup[0])&&(g.push({bindOnce:a.$isBindOnce(b.classList[h]),bind:b.classList[h],last:""}),b.classList.remove(b.classList[h]),h-=1,f-=1);g.length&&(e=a.$watch(d)),a.$on("$destroy",function(){g.length=0,a=null,b=null,c=null})}]}})}),j("hb.directive",["hb.val"],function(a){return a}),j("hb.val",function(){var a={},b=function(b,c){return"undefined"==typeof c?a[b]:void(a[b]=c)};return b.init=function(b){for(var c in a)b.val(c,a[c])},b}),j("getUID",function(){function a(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}return a}),i("http",["extend"],function(a){function b(a){this.init(a)}function c(a){var b,c,e=d(this.getAllResponseHeaders()),f=this.responseText.trim();return f&&(b=f[0],c=f[f.length-1]),(f&&"{"===b&&"}"===c||"["===b&&"]"===c)&&(f=f?JSON.parse(f.replace(/\/\*.*?\*\//g,"")):f),{data:f,request:{method:a.method,url:a.url,data:a.data,headers:a.headers},headers:e,status:this.status}}function d(a){for(var b,c=a.split("\n"),d={},e=0,f=c.length;f>e;)b=c[e].split(": "),b[0]&&b[1]&&(b[0]=b[0].split("-").join("").split(""),b[0][0]=b[0][0].toLowerCase(),d[b[0].join("")]=b[1]),e+=1;return d}function e(b,c){return a(b,c)}function f(a){return!(!m.intercept||!m.intercept(a,b))}var g,h=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},i=window,j=function(){var a;return i.XMLHttpRequest&&"withCredentials"in new i.XMLHttpRequest?a=i.XMLHttpRequest:i.XDomainRequest&&(a=i.XDomainRequest),a}(),k=["head","get","post","put","delete"],l=k.length,m={};for(b.prototype.init=function(a){var b=this;return b.xhr=new j,b.method=a.method,b.url=a.url,b.success=a.success,b.error=a.error,b.data=a.data,b.headers=a.headers,a.credentials===!0&&(b.xhr.withCredentials=!0),b.send(),b},b.prototype.send=function(){var a=this;if("GET"===a.method&&a.data){var b=a.url.indexOf("?")>-1?"&":"?";a.url+=b+h(a.data)}else a.data=JSON.stringify(a.data);return void 0!==a.success&&(a.xhr.onload=function(){function b(){e.status>=200&&e.status<400?a.success.call(e,d):void 0!==a.error&&a.error.call(e,d)}var d=c.call(this,a),e=this;this.onloadInterceptor?this.onloadInterceptor(b,d):b()}),void 0!==a.error&&(a.xhr.error=function(){var b=c.call(this,a);a.error.call(this,b)}),a.xhr.open(a.method,a.url,!0),void 0!==a.headers&&a.setHeaders(),a.xhr.send(a.data,!0),a},b.prototype.setHeaders=function(){var a,b=this,c=b.headers;for(a in c)c.hasOwnProperty(a)&&b.xhr.setRequestHeader(a,c[a]);return b},g=0;l>g;g+=1)!function(){var a=k[g];m[a]=function(c,d,g){var h={};if(void 0===c)throw new Error("CORS: url must be defined");return"object"==typeof c?h=c:("function"==typeof d&&(h.success=d),"function"==typeof g&&(h.error=g),h.url=c),h.method=a.toUpperCase(),e(h,m.defaults),f(h)?void 0:new b(h).xhr}}();return m.intercept=null,m.defaults={headers:{}},m}),i("extend",["toArray"],function(a){var b=function(c,d){var e,f,g,h=a(arguments),i=1,j=h.length,k=this||{};for(!c&&d&&"object"==typeof d&&(c={});j>i;){e=h[i];for(f in e)e.hasOwnProperty(f)&&("length"===f&&c instanceof Array||(c[f]&&"object"==typeof c[f]&&!e[f]instanceof Array?c[f]=b.apply(k,[c[f],e[f]]):e[f]instanceof Array?(g=k&&k.concat?(c[f]||[]).concat(e[f]):e[f],k&&k.arrayAsObject?(c[f]||(c[f]={length:g.length}),c[f]instanceof Array&&(c[f]=b.apply(k,[{},c[f]]))):c[f]=c[f]||[],g.length&&(c[f]=b.apply(k,[c[f],g]))):e[f]&&"object"==typeof e[f]?(k.objectAsArray&&"number"==typeof e[f].length&&(c[f]instanceof Array||(c[f]=b.apply(k,[[],c[f]]))),c[f]=b.apply(k,[c[f]||{},e[f]])):(k.override!==!1||void 0===c[f])&&(c[f]=e[f])));i+=1}return c};return b}),i("toArray",["isArguments","isArray","isUndefined"],function(a,b,c){var d=function(d){if(a(d))return Array.prototype.slice.call(d,0)||[];try{if(b(d))return d;if(!c(d))return[].concat(d)}catch(e){}return[]};return d}),i("isArguments",["toString"],function(a){var b=function(b){var c=String(b),d="[object Arguments]"===c;return d||(d="[object Array]"!==c&&null!==b&&"object"==typeof b&&"number"==typeof b.length&&b.length>=0&&(!b.callee||"[object Function]"===a.call(b.callee))),d};return b}),i("isArray",function(){Array.prototype.__isArray=!0,Object.defineProperty(Array.prototype,"__isArray",{enumerable:!1,writable:!0});var a=function(a){return a?!!a.__isArray:!1};return a}),i("isUndefined",function(){var a=function(a){return"undefined"==typeof a};return a});for(var l in d)k(l,d[l])}(this.evolution||{},function(){return this}());
//# sourceMappingURL=evolution.min.js.map